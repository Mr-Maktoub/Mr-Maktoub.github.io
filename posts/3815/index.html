<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>训练小tricks | 马克图布</title><meta name="author" content="马克图布"><meta name="copyright" content="马克图布"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="工具pytorch内存相关原地操作运行一些操作可能会导致为新结果分配内存。 例如，如果我们用Y&#x3D;X+Y，我们将取消引用Y指向的张量，而是指向新分配的内存处的张量。 123before &#x3D; id(Y)Y &#x3D; Y + Xid(Y) &#x3D;&#x3D; before 1False 首先，我们不想总是不必要地分配内存。在机器学习中，我们可能有数百兆的参数，并且在一秒内多次更新所有参数。 通常情况下，我们希望原地执行这些">
<meta property="og:type" content="article">
<meta property="og:title" content="训练小tricks">
<meta property="og:url" content="https://mr-maktoub.github.io/posts/3815/index.html">
<meta property="og:site_name" content="马克图布">
<meta property="og:description" content="工具pytorch内存相关原地操作运行一些操作可能会导致为新结果分配内存。 例如，如果我们用Y&#x3D;X+Y，我们将取消引用Y指向的张量，而是指向新分配的内存处的张量。 123before &#x3D; id(Y)Y &#x3D; Y + Xid(Y) &#x3D;&#x3D; before 1False 首先，我们不想总是不必要地分配内存。在机器学习中，我们可能有数百兆的参数，并且在一秒内多次更新所有参数。 通常情况下，我们希望原地执行这些">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://mr-maktoub.github.io/img/avatar1.png">
<meta property="article:published_time" content="2022-09-11T01:13:59.000Z">
<meta property="article:modified_time" content="2023-05-24T14:24:30.214Z">
<meta property="article:author" content="马克图布">
<meta property="article:tag" content="trick">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://mr-maktoub.github.io/img/avatar1.png"><link rel="shortcut icon" href="/img/log3.jfif"><link rel="canonical" href="https://mr-maktoub.github.io/posts/3815/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '训练小tricks',
  isPost: true,
  isHome: false,
  isHighlightShrink: true,
  isToc: true,
  postUpdate: '2023-05-24 22:24:30'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"><style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar1.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">66</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">22</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">13</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw iconfont icon-shouyex"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw iconfont icon-zuixinwenzhang_huaban"></i><span> 找文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw iconfont icon-fenlei1"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw iconfont icon-biaoqian1"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw iconfont icon-shijianzhou"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw iconfont icon-shenghuo"></i><span> 生活</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/messageboard/"><i class="fa-fw iconfont icon-liaotian-04"></i><span> 留言板</span></a></li><li><a class="site-page child" href="/link/"><i class="fa-fw iconfont icon-lianjie"></i><span> 友人帐</span></a></li><li><a class="site-page child" href="/share/"><i class="fa-fw iconfont icon-fenxiang"></i><span> 分享</span></a></li><li><a class="site-page child" href="/gallery/"><i class="fa-fw iconfont icon-xiangce"></i><span> 相册</span></a></li><li><a class="site-page child" href="/books/"><i class="fa-fw iconfont icon-shuji"></i><span> 书籍</span></a></li><li><a class="site-page child" href="/FilmAndTV/"><i class="fa-fw iconfont icon-yingshi1"></i><span> 影视</span></a></li><li><a class="site-page child" href="/daohang/"><i class="fa-fw iconfont icon-daohang"></i><span> 导航站</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw iconfont icon-gerenzhongxin"></i><span> 关于笔者</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/cover.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="马克图布"><img class="site-icon" src="/img/log3.jfif"/><span class="site-name">马克图布</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw iconfont icon-shouyex"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw iconfont icon-zuixinwenzhang_huaban"></i><span> 找文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw iconfont icon-fenlei1"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw iconfont icon-biaoqian1"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw iconfont icon-shijianzhou"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw iconfont icon-shenghuo"></i><span> 生活</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/messageboard/"><i class="fa-fw iconfont icon-liaotian-04"></i><span> 留言板</span></a></li><li><a class="site-page child" href="/link/"><i class="fa-fw iconfont icon-lianjie"></i><span> 友人帐</span></a></li><li><a class="site-page child" href="/share/"><i class="fa-fw iconfont icon-fenxiang"></i><span> 分享</span></a></li><li><a class="site-page child" href="/gallery/"><i class="fa-fw iconfont icon-xiangce"></i><span> 相册</span></a></li><li><a class="site-page child" href="/books/"><i class="fa-fw iconfont icon-shuji"></i><span> 书籍</span></a></li><li><a class="site-page child" href="/FilmAndTV/"><i class="fa-fw iconfont icon-yingshi1"></i><span> 影视</span></a></li><li><a class="site-page child" href="/daohang/"><i class="fa-fw iconfont icon-daohang"></i><span> 导航站</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw iconfont icon-gerenzhongxin"></i><span> 关于笔者</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">训练小tricks</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-09-11T01:13:59.000Z" title="发表于 2022-09-11 09:13:59">2022-09-11</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-05-24T14:24:30.214Z" title="更新于 2023-05-24 22:24:30">2023-05-24</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/">机器学习</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="训练小tricks"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h2><h3 id="pytorch"><a href="#pytorch" class="headerlink" title="pytorch"></a>pytorch</h3><h4 id="内存相关"><a href="#内存相关" class="headerlink" title="内存相关"></a>内存相关</h4><h5 id="原地操作"><a href="#原地操作" class="headerlink" title="原地操作"></a>原地操作</h5><p>运行一些操作可能会导致为新结果分配内存。 例如，如果我们用<code>Y=X+Y</code>，我们将取消引用<code>Y</code>指向的张量，而是指向新分配的内存处的张量。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">before = <span class="built_in">id</span>(Y)</span><br><span class="line">Y = Y + X</span><br><span class="line"><span class="built_in">id</span>(Y) == before</span><br></pre></td></tr></table></figure>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">False</span><br></pre></td></tr></table></figure>
<p>首先，我们不想总是不必要地分配内存。在机器学习中，我们可能有数百兆的参数，并且在一秒内多次更新所有参数。 通常情况下，我们希望原地执行这些更新。 其次，如果我们不原地更新，其他引用仍然会指向旧的内存位置， 这样我们的某些代码可能会无意中引用旧的参数。</p>
<p>幸运的是，执行原地操作非常简单。 我们可以使用切片表示法将操作的结果分配给先前分配的数组，例如<code>Y[:] = &lt;expression&gt;</code>。 为了说明这一点，我们首先创建一个新的矩阵<code>Z</code>，其形状与另一个<code>Y</code>相同， 使用<code>zeros_like</code>来分配一个全0的块。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Z = torch.zeros_like(Y)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">'id(Z):'</span>, <span class="built_in">id</span>(Z))</span><br><span class="line">Z[:] = X + Y</span><br><span class="line"><span class="built_in">print</span>(<span class="string">'id(Z):'</span>, <span class="built_in">id</span>(Z))</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">id(Z): 139931132035296</span><br><span class="line">id(Z): 139931132035296</span><br></pre></td></tr></table></figure>
<p>如果在后续计算中没有重复使用<code>X</code>， 我们也可以使用<code>X[:] = X + Y</code>或<code>X += Y</code>来减少操作的内存开销</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">before = <span class="built_in">id</span>(X)</span><br><span class="line">X += Y</span><br><span class="line"><span class="built_in">id</span>(X) == before</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<p><code>True</code></p>
<h4 id="EarlyStopping"><a href="#EarlyStopping" class="headerlink" title="EarlyStopping"></a>EarlyStopping</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定义 EarlyStopping Callback</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EarlyStopping</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, patience=<span class="number">10</span>, delta=<span class="number">0</span></span>):</span><br><span class="line">        self.patience = patience</span><br><span class="line">        self.delta = delta</span><br><span class="line">        self.best_score = <span class="literal">None</span></span><br><span class="line">        self.counter = <span class="number">0</span></span><br><span class="line">        self.early_stop = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__call__</span>(<span class="params">self, val_loss</span>):</span><br><span class="line">        score = -val_loss</span><br><span class="line">        <span class="keyword">if</span> self.best_score <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            self.best_score = score</span><br><span class="line">        <span class="keyword">elif</span> score &lt; self.best_score + self.delta:</span><br><span class="line">            self.counter += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> self.counter &gt;= self.patience:</span><br><span class="line">                self.early_stop = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.best_score = score</span><br><span class="line">            self.counter = <span class="number">0</span></span><br></pre></td></tr></table></figure>
<h3 id="linux-服务器守护线程——tmux"><a href="#linux-服务器守护线程——tmux" class="headerlink" title="linux 服务器守护线程——tmux"></a>linux 服务器守护线程——tmux</h3><p><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.05ex;" xmlns="http://www.w3.org/2000/svg" width="14.162ex" height="1.643ex" role="img" focusable="false" viewBox="0 -704 6259.6 726"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D43B" d="M228 637Q194 637 192 641Q191 643 191 649Q191 673 202 682Q204 683 219 683Q260 681 355 681Q389 681 418 681T463 682T483 682Q499 682 499 672Q499 670 497 658Q492 641 487 638H485Q483 638 480 638T473 638T464 637T455 637Q416 636 405 634T387 623Q384 619 355 500Q348 474 340 442T328 395L324 380Q324 378 469 378H614L615 381Q615 384 646 504Q674 619 674 627T617 637Q594 637 587 639T580 648Q580 650 582 660Q586 677 588 679T604 682Q609 682 646 681T740 680Q802 680 835 681T871 682Q888 682 888 672Q888 645 876 638H874Q872 638 869 638T862 638T853 637T844 637Q805 636 794 634T776 623Q773 618 704 340T634 58Q634 51 638 51Q646 48 692 46H723Q729 38 729 37T726 19Q722 6 716 0H701Q664 2 567 2Q533 2 504 2T458 2T437 1Q420 1 420 10Q420 15 423 24Q428 43 433 45Q437 46 448 46H454Q481 46 514 49Q520 50 522 50T528 55T534 64T540 82T547 110T558 153Q565 181 569 198Q602 330 602 331T457 332H312L279 197Q245 63 245 58Q245 51 253 49T303 46H334Q340 38 340 37T337 19Q333 6 327 0H312Q275 2 178 2Q144 2 115 2T69 2T48 1Q31 1 31 10Q31 12 34 24Q39 43 44 45Q48 46 59 46H65Q92 46 125 49Q139 52 144 61Q147 65 216 339T285 628Q285 635 228 637Z"></path></g><g data-mml-node="mi" transform="translate(888,0)"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"></path></g><g data-mml-node="mi" transform="translate(1651,0)"><path data-c="1D440" d="M289 629Q289 635 232 637Q208 637 201 638T194 648Q194 649 196 659Q197 662 198 666T199 671T201 676T203 679T207 681T212 683T220 683T232 684Q238 684 262 684T307 683Q386 683 398 683T414 678Q415 674 451 396L487 117L510 154Q534 190 574 254T662 394Q837 673 839 675Q840 676 842 678T846 681L852 683H948Q965 683 988 683T1017 684Q1051 684 1051 673Q1051 668 1048 656T1045 643Q1041 637 1008 637Q968 636 957 634T939 623Q936 618 867 340T797 59Q797 55 798 54T805 50T822 48T855 46H886Q892 37 892 35Q892 19 885 5Q880 0 869 0Q864 0 828 1T736 2Q675 2 644 2T609 1Q592 1 592 11Q592 13 594 25Q598 41 602 43T625 46Q652 46 685 49Q699 52 704 61Q706 65 742 207T813 490T848 631L654 322Q458 10 453 5Q451 4 449 3Q444 0 433 0Q418 0 415 7Q413 11 374 317L335 624L267 354Q200 88 200 79Q206 46 272 46H282Q288 41 289 37T286 19Q282 3 278 1Q274 0 267 0Q265 0 255 0T221 1T157 2Q127 2 95 1T58 0Q43 0 39 2T35 11Q35 13 38 25T43 40Q45 46 65 46Q135 46 154 86Q158 92 223 354T289 629Z"></path></g><g data-mml-node="mi" transform="translate(2702,0)"><path data-c="1D438" d="M492 213Q472 213 472 226Q472 230 477 250T482 285Q482 316 461 323T364 330H312Q311 328 277 192T243 52Q243 48 254 48T334 46Q428 46 458 48T518 61Q567 77 599 117T670 248Q680 270 683 272Q690 274 698 274Q718 274 718 261Q613 7 608 2Q605 0 322 0H133Q31 0 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H757Q764 676 764 669Q764 664 751 557T737 447Q735 440 717 440H705Q698 445 698 453L701 476Q704 500 704 528Q704 558 697 578T678 609T643 625T596 632T532 634H485Q397 633 392 631Q388 629 386 622Q385 619 355 499T324 377Q347 376 372 376H398Q464 376 489 391T534 472Q538 488 540 490T557 493Q562 493 565 493T570 492T572 491T574 487T577 483L544 351Q511 218 508 216Q505 213 492 213Z"></path></g><g data-mml-node="mo" transform="translate(3743.8,0)"><path data-c="3A" d="M78 370Q78 394 95 412T138 430Q162 430 180 414T199 371Q199 346 182 328T139 310T96 327T78 370ZM78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z"></path></g><g data-mml-node="mi" transform="translate(4299.6,0)"><path data-c="1D452" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path></g><g data-mml-node="mi" transform="translate(4765.6,0)"><path data-c="1D450" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path></g><g data-mml-node="mi" transform="translate(5198.6,0)"><path data-c="210E" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mi" transform="translate(5774.6,0)"><path data-c="1D45C" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g></g></g></svg></mjx-container>HOME = ‘/data/kangbaobin’【是Linux中的一个环境变量，表示用户初次登陆时的起始目录名】</p>
<p>Xshell断开连接后仍保持服务器程序执行</p>
<p>先安装tmux：</p>
<p>root用户安装仅需一行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install tmux</span><br></pre></td></tr></table></figure>
<p>非root用户</p>
<p>1、下载与解压</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget -c https://github.com/tmux/tmux/releases/download/3.0a/tmux-3.0a.tar.gz</span><br><span class="line">wget -c https://github.com/libevent/libevent/releases/download/release-2.1.11-stable/libevent-2.1.11-stable.tar.gz</span><br><span class="line">wget -c https://ftp.gnu.org/gnu/ncurses/ncurses-6.2.tar.gz</span><br></pre></td></tr></table></figure>
<p>解压指令如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tar -xzvf tmux-3.0a.tar.gz</span><br><span class="line">tar -xzvf libevent-2.1.11-stable.tar.gz</span><br><span class="line">tar -xzvf ncurses-6.2.tar.gz</span><br></pre></td></tr></table></figure>
<p>2、安装</p>
<p>libevent会安在 /data/kangbaobin/tmux/tmux_depend / lib</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cd  libevent-2.1.11-stable</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">      <span class="variable">$HOME</span>/data/kangbaobin/tmux/tmux_depend 是我的安装路径，大家可以修改</span></span><br><span class="line"> </span><br><span class="line">./configure --prefix=$HOME/data/kangbaobin/tmux/tmux_depend --disable-shared</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>
<p>ncurses会安在 /data/kangbaobin/tmux/tmux_depend / include</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd  ncurses-6.2</span><br><span class="line">./configure --prefix=$HOME/data/kangbaobin/tmux/tmux_depend</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>
<p>安装tmux </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd  tmux-3.0a</span><br><span class="line">./configure CFLAGS="-I$HOME/data/kangbaobin/tmux/tmux_depend/include -I/$HOME/data/kangbaobin/tmux/tmux_depend/include/ncurses" LDFLAGS="-L/$HOME/data/kangbaobin/tmux/tmux_depend/lib -L/$HOME/data/kangbaobin/tmux/tmux_depend/include/ncurses -L/$HOME/data/kangbaobin/tmux/tmux_depend/include"</span><br><span class="line">make</span><br><span class="line">cp tmux  $HOME/data/kangbaobin/tmux/tmux_depend/bin</span><br></pre></td></tr></table></figure>
<p>3、设置环境变量（此步骤建议手动添加到bashrc文件中）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export PATH=$HOME/data/kangbaobin/tmux/tmux_depend/bin:$PATH</span><br><span class="line">source ~/.bashrc</span><br></pre></td></tr></table></figure>
<p>配置tmux文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd ~</span><br><span class="line">vim .tmux.conf</span><br><span class="line">copy follow code</span><br><span class="line">source .tmux.conf</span><br></pre></td></tr></table></figure>
<p><code>.tmux.conf</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">set-option -g status-keys vi</span><br><span class="line">setw -g mode-keys vi</span><br><span class="line"></span><br><span class="line">setw -g monitor-activity on</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">setw -g c0-change-trigger 10</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">setw -g c0-change-interval 100</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">setw -g c0-change-interval 50</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">setw -g c0-change-trigger  75</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">set-window-option -g automatic-rename on</span><br><span class="line">set-option -g set-titles on</span><br><span class="line">set -g history-limit 100000</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">set-window-option -g utf8 on</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">set</span> <span class="built_in">command</span> prefix</span></span><br><span class="line">set-option -g prefix C-a</span><br><span class="line">unbind-key C-b</span><br><span class="line">bind-key C-a send-prefix</span><br><span class="line"></span><br><span class="line">bind h select-pane -L</span><br><span class="line">bind j select-pane -D</span><br><span class="line">bind k select-pane -U</span><br><span class="line">bind l select-pane -R</span><br><span class="line"></span><br><span class="line">bind -n M-Left select-pane -L</span><br><span class="line">bind -n M-Right select-pane -R</span><br><span class="line">bind -n M-Up select-pane -U</span><br><span class="line">bind -n M-Down select-pane -D</span><br><span class="line"></span><br><span class="line">bind &lt; resize-pane -L 7</span><br><span class="line">bind &gt; resize-pane -R 7</span><br><span class="line">bind - resize-pane -D 7</span><br><span class="line">bind + resize-pane -U 7</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">bind-key -n M-l next-window</span><br><span class="line">bind-key -n M-h previous-window</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">set -g status-interval 1</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">status bar</span></span><br><span class="line">set -g status-bg black</span><br><span class="line">set -g status-fg blue</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="built_in">set</span> -g status-utf8 on</span></span><br><span class="line">set -g status-justify centre</span><br><span class="line">set -g status-bg default</span><br><span class="line">set -g status-left " #[fg=green]#S@#H #[default]"</span><br><span class="line">set -g status-left-length 20</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">mouse support</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="keyword">for</span> tmux 2.1</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">set</span> -g mouse-utf8 on</span></span><br><span class="line"></span><br><span class="line">set-option -g mouse on</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="keyword">for</span> previous version</span></span><br><span class="line">set -g mode-mouse on</span><br><span class="line">set -g mouse-resize-pane on</span><br><span class="line">set -g mouse-select-pane on</span><br><span class="line">set -g mouse-select-window on</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="built_in">set</span> -g status-right-length 25</span></span><br><span class="line">set -g status-right "#[fg=green]%H:%M:%S #[fg=magenta]%a %m-%d #[default]"</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">fix <span class="keyword">for</span> tmux 1.9</span></span><br><span class="line">bind '"' split-window -vc "#{pane_current_path}"</span><br><span class="line">bind '%' split-window -hc "#{pane_current_path}"</span><br><span class="line">bind 'c' new-window -c "#{pane_current_path}"</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">run-shell <span class="string">"powerline-daemon -q"</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">vim: ft=conf</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>chatgpt生成注解</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line">set-option -g status-keys vi #将状态栏键绑定设置为vi风格，使您可以在状态栏中使用vi风格的键绑定。</span><br><span class="line">setw -g mode-keys vi #将tmux命令模式的键绑定设置为vi风格，这意味着您可以使用vi风格的命令来操作tmux。</span><br><span class="line">setw -g monitor-activity on #启用tmux活动监视功能，这将使tmux能够检测到在窗格中发生的活动（如输出或光标移动），并将其通知给用户。</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">这四行配置用于设置tmux活动检测功能的参数，但是它们都是被注释掉的，因此实际上并没有对tmux的行为产生任何影响。</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">setw -g c0-change-trigger 10</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">setw -g c0-change-interval 100</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">setw -g c0-change-interval 50</span>  </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">setw -g c0-change-trigger  75</span></span><br><span class="line">set-window-option -g automatic-rename on #启用tmux自动重命名窗口功能，使tmux能够自动为您命名新创建的窗口。</span><br><span class="line">set-option -g set-titles on #启用tmux设置终端标题功能，这将使tmux能够设置终端标题，以便您可以更轻松地区分不同的tmux窗口。</span><br><span class="line">set -g history-limit 100000 #将tmux历史记录的大小限制设置为100000行。</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">将tmux命令前缀键设置为Ctrl-a，并解除原有的Ctrl-b前缀键绑定。然后，将Ctrl-a绑定为发送前缀，这意味着按下Ctrl-a后，紧接着的按键将被解释为命令前缀。</span></span><br><span class="line">set-option -g prefix C-a</span><br><span class="line">unbind-key C-b</span><br><span class="line">bind-key C-a send-prefix</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">将h、j、k、l键绑定为在当前tmux窗格中向左、下、上和右移动光标。</span></span><br><span class="line">bind h select-pane -L</span><br><span class="line">bind j select-pane -D</span><br><span class="line">bind k select-pane -U</span><br><span class="line">bind l select-pane -R</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">将Alt+方向键绑定为在当前tmux窗格中向左、右、上和下移动光标。</span></span><br><span class="line">bind -n M-Left select-pane -L</span><br><span class="line">bind -n M-Right select-pane -R</span><br><span class="line">bind -n M-Up select-pane -U</span><br><span class="line">bind -n M-Down select-pane -D</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">将&lt;、&gt;、-、+键绑定为调整当前tmux窗格的大小。</span></span><br><span class="line">bind &lt; resize-pane -L 7</span><br><span class="line">bind &gt; resize-pane -R 7</span><br><span class="line">bind - resize-pane -D 7</span><br><span class="line">bind + resize-pane -U 7</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">这部分配置设置了一些快捷键，以方便在tmux窗口中进行各种操作。这些快捷键包括：</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">prefix C-a：设置tmux命令前缀为Ctrl + a。</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">send-prefix：将前缀键发送到tmux会话中。</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">select-pane：选择不同的窗格（pane）。</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">resize-pane：调整当前窗格的大小。</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">next-window和previous-window：选择下一个或前一个窗口。</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">set</span> <span class="built_in">command</span> prefix</span></span><br><span class="line">set-option -g prefix C-a</span><br><span class="line">unbind-key C-b</span><br><span class="line">bind-key C-a send-prefix</span><br><span class="line"></span><br><span class="line">bind h select-pane -L</span><br><span class="line">bind j select-pane -D</span><br><span class="line">bind k select-pane -U</span><br><span class="line">bind l select-pane -R</span><br><span class="line"></span><br><span class="line">bind -n M-Left select-pane -L</span><br><span class="line">bind -n M-Right select-pane -R</span><br><span class="line">bind -n M-Up select-pane -U</span><br><span class="line">bind -n M-Down select-pane -D</span><br><span class="line"></span><br><span class="line">bind &lt; resize-pane -L 7</span><br><span class="line">bind &gt; resize-pane -R 7</span><br><span class="line">bind - resize-pane -D 7</span><br><span class="line">bind + resize-pane -U 7</span><br><span class="line"></span><br><span class="line">bind-key -n M-l next-window</span><br><span class="line">bind-key -n M-h previous-window</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">这部分配置设置了tmux的状态栏和鼠标支持。其中，status-left和status-right用于设置状态栏的左侧和右侧内容，包括日期、时间等信息。mouse-*设置用于启用鼠标支持。split-window和new-window快捷键用于创建新窗格和新窗口。最后的vim: ft=conf用于指定文件类型为conf，以便文本编辑器可以正确地突出显示语法。</span></span><br><span class="line"></span><br><span class="line">set -g status-interval 1</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">status bar</span></span><br><span class="line">set -g status-bg black</span><br><span class="line">set -g status-fg blue</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="built_in">set</span> -g status-utf8 on</span></span><br><span class="line">set -g status-justify centre</span><br><span class="line">set -g status-bg default</span><br><span class="line">set -g status-left " #[fg=green]#S@#H #[default]"</span><br><span class="line">set -g status-left-length 20</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">mouse support</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="keyword">for</span> tmux 2.1</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">set</span> -g mouse-utf8 on</span></span><br><span class="line"></span><br><span class="line">set-option -g mouse on</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="keyword">for</span> previous version</span></span><br><span class="line">set -g mode-mouse on</span><br><span class="line">set -g mouse-resize-pane on</span><br><span class="line">set -g mouse-select-pane on</span><br><span class="line">set -g mouse-select-window on</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="built_in">set</span> -g status-right-length 25</span></span><br><span class="line">set -g status-right "#[fg=green]%H:%M:%S #[fg=magenta]%a %m-%d #[default]"</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">fix <span class="keyword">for</span> tmux 1.9</span></span><br><span class="line">bind '"' split-window -vc "#{pane_current_path}"</span><br><span class="line">bind '%' split-window -hc "#{pane_current_path}"</span><br><span class="line">bind 'c' new-window -c "#{pane_current_path}"</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">run-shell <span class="string">"powerline-daemon -q"</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">vim: ft=conf</span></span><br></pre></td></tr></table></figure>
<p>tmux常用命令</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">1）新建会话，比如新创建一个会话以"ccc"命名</span><br><span class="line"> </span><br><span class="line">[root@Centos6 ~]# tmux new -s ccc</span><br><span class="line"> </span><br><span class="line">加上参数-d，表示在后台新建会话</span><br><span class="line"> </span><br><span class="line">root@bobo:~# tmux new -s shibo -d</span><br><span class="line"> </span><br><span class="line">root@bobo:~# tmux ls</span><br><span class="line"> </span><br><span class="line">shibo: 1 windows (created Tue Oct  2 19:22:32 2018) [135x35]</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">2）查看创建得所有会话</span><br><span class="line"> </span><br><span class="line">[root@Centos6 ~]# tmux ls</span><br><span class="line"> </span><br><span class="line">0: 1 windows (created Wed Aug 30 17:58:20 2017) [112x22](attached)    #这里的attached表示该会话是当前会话</span><br><span class="line"> </span><br><span class="line">aaa: 2 windows (created Wed Aug 30 16:54:33 2017) [112x22]</span><br><span class="line"> </span><br><span class="line">ccc: 1 windows (created Wed Aug 30 17:01:05 2017) [112x22]</span><br><span class="line"> </span><br><span class="line">   </span><br><span class="line"> </span><br><span class="line">3）登录一个已知会话。即从终端环境进入会话。</span><br><span class="line"> </span><br><span class="line">第一个参数a也可以写成attach。后面的aaa是会话名称。</span><br><span class="line"> </span><br><span class="line">[root@Centos6 ~]# tmux a -t aaa </span><br><span class="line"> </span><br><span class="line">　　</span><br><span class="line"> </span><br><span class="line">4）退出会话不是关闭：</span><br><span class="line"> </span><br><span class="line">登到某一个会话后，先按键ctrl+b启动快捷键，再按d，这样就会退出该会话，但不会关闭会话。</span><br><span class="line"> </span><br><span class="line">如果直接ctrl + d，就会在退出会话的通话也关闭了该会话！</span><br><span class="line"> </span><br><span class="line">   </span><br><span class="line"> </span><br><span class="line">5）关闭会话（销毁会话）</span><br><span class="line"> </span><br><span class="line">[root@Centos6 ~]# tmux ls</span><br><span class="line"> </span><br><span class="line">aaa: 2 windows (created Wed Aug 30 16:54:33 2017) [112x22]</span><br><span class="line"> </span><br><span class="line">bbb: 1 windows (created Wed Aug 30 19:02:09 2017) [112x22]</span><br><span class="line"> </span><br><span class="line">   </span><br><span class="line"> </span><br><span class="line">[root@Centos6 ~]# tmux kill-session -t bbb</span><br><span class="line"> </span><br><span class="line">   </span><br><span class="line"> </span><br><span class="line">[root@Centos6 ~]# tmux ls</span><br><span class="line"> </span><br><span class="line">aaa: 2 windows (created Wed Aug 30 16:54:33 2017) [112x22]</span><br><span class="line"></span><br><span class="line">#kill 拆分的窗口</span><br><span class="line">首先，使用tmux命令列出当前活动的窗格：</span><br><span class="line">$ tmux list-panes</span><br><span class="line">根据上述命令的输出，确定要关闭的窗格的ID或索引。</span><br><span class="line">使用tmux的kill-pane命令来关闭指定的窗格。例如，要关闭窗格#1，您可以使用以下命令：</span><br><span class="line">$ tmux kill-pane -t 1</span><br><span class="line"></span><br><span class="line">其中，“-t”选项后面是您要关闭的窗格的ID或索引。</span><br><span class="line"></span><br><span class="line">请注意，这将立即关闭该窗格，并将其从当前tmux会话中删除，无法撤销。如果您不确定要关闭哪个窗格，请在关闭之前先使用tmux list-panes命令进行确认。</span><br><span class="line"></span><br><span class="line">6）重命名会话</span><br><span class="line"> </span><br><span class="line">[root@Centos6 ~]# tmux ls  </span><br><span class="line"> </span><br><span class="line">wangshibo: 1 windows (created Sun Sep 30 10:17:00 2018) [136x29] (attached)</span><br><span class="line"> </span><br><span class="line">  </span><br><span class="line"> </span><br><span class="line">[root@Centos6 ~]# tmux rename -t wangshibo kevin</span><br><span class="line"> </span><br><span class="line">  </span><br><span class="line"> </span><br><span class="line">[root@Centos6 ~]# tmux ls</span><br><span class="line"> </span><br><span class="line">kevin: 1 windows (created Sun Sep 30 10:17:00 2018) [136x29] (attached)</span><br></pre></td></tr></table></figure>
<h3 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h3><p>计时器</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Timer</span>:  </span><br><span class="line">    <span class="string">"""记录多次运行时间"""</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.times = []</span><br><span class="line">        self.start()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">start</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">"""启动计时器"""</span></span><br><span class="line">        self.tik = time.time()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">stop</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">"""停止计时器并将时间记录在列表中"""</span></span><br><span class="line">        self.times.append(time.time() - self.tik)</span><br><span class="line">        <span class="keyword">return</span> self.times[-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">avg</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">"""返回平均时间"""</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">sum</span>(self.times) / <span class="built_in">len</span>(self.times)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">sum</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">"""返回时间总和"""</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">sum</span>(self.times)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">cumsum</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">"""返回累计时间"""</span></span><br><span class="line">        <span class="keyword">return</span> np.array(self.times).cumsum().tolist()</span><br></pre></td></tr></table></figure>
<p>lambda函数</p>
<ul>
<li>lambda函数是一种匿名函数，即没有名字的函数</li>
<li>使用lambda保留字定义，函数名是返回结果</li>
<li>lambda函数的函数体只是一个表达式</li>
<li>lambda函数用于定义简单的、能够在一行内表示的函数</li>
<li>lambda表达式” : “后面，只能有一个表达式，def则可以有多个。</li>
<li>lambda一般用来定义简单的函数(单行函数)，而def可以定义复杂的函数</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">g = <span class="keyword">lambda</span> x:x*x+<span class="number">1</span></span><br><span class="line">g(<span class="number">3</span>)<span class="comment">#10</span></span><br></pre></td></tr></table></figure>
<p> 封装日志类</p>
<p>以下是一个比较复杂的 Python 封装日志类的示例代码，其中包含了很多不同的功能和选项：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CustomLogger</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, logger_name, log_level=logging.DEBUG, log_dir=<span class="literal">None</span>, log_filename=<span class="literal">None</span>, console_log=<span class="literal">True</span>, file_log=<span class="literal">True</span></span>):</span><br><span class="line"></span><br><span class="line">        <span class="comment"># create logger</span></span><br><span class="line">        self.logger = logging.getLogger(logger_name)</span><br><span class="line">        self.logger.setLevel(log_level)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># set log format</span></span><br><span class="line">        formatter = logging.Formatter(<span class="string">'%(asctime)s - %(name)s - %(levelname)s - %(message)s'</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># add console handler</span></span><br><span class="line">        <span class="keyword">if</span> console_log:</span><br><span class="line">            ch = logging.StreamHandler(sys.stdout)</span><br><span class="line">            ch.setFormatter(formatter)</span><br><span class="line">            self.logger.addHandler(ch)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># add file handler</span></span><br><span class="line">        <span class="keyword">if</span> file_log:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> log_dir:</span><br><span class="line">                log_dir = os.getcwd()</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> log_filename:</span><br><span class="line">                log_filename = logger_name + <span class="string">'.log'</span></span><br><span class="line">            log_file_path = os.path.join(log_dir, log_filename)</span><br><span class="line">            fh = logging.FileHandler(log_file_path)</span><br><span class="line">            fh.setFormatter(formatter)</span><br><span class="line">            self.logger.addHandler(fh)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">debug</span>(<span class="params">self, message</span>):</span><br><span class="line">        self.logger.debug(message)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">info</span>(<span class="params">self, message</span>):</span><br><span class="line">        self.logger.info(message)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">warning</span>(<span class="params">self, message</span>):</span><br><span class="line">        self.logger.warning(message)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">error</span>(<span class="params">self, message</span>):</span><br><span class="line">        self.logger.error(message)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">critical</span>(<span class="params">self, message</span>):</span><br><span class="line">        self.logger.critical(message)</span><br></pre></td></tr></table></figure>
<p>在上面的代码中，<code>CustomLogger</code> 类接受以下参数：</p>
<ul>
<li><code>logger_name</code>：指定 logger 的名称。</li>
<li><code>log_level</code>：指定 logger 的日志级别，默认为 <code>logging.DEBUG</code>。</li>
<li><code>log_dir</code>：指定日志文件存储的目录，默认为当前工作目录。</li>
<li><code>log_filename</code>：指定日志文件的文件名，默认为 logger 的名称加上 <code>.log</code> 后缀。</li>
<li><code>console_log</code>：如果为 True，将会向控制台输出日志。</li>
<li><code>file_log</code>：如果为 True，将会将日志写入文件。</li>
</ul>
<p><code>CustomLogger</code> 类在初始化时会创建 logger 对象，并设置日志级别。然后，它会根据给定的参数决定是否添加控制台处理器和文件处理器。控制台处理器将日志输出到标准输出流，文件处理器将日志写入指定的文件。如果没有指定日志文件的存储目录和文件名，则会使用当前工作目录和 logger 名称加上 <code>.log</code> 后缀。</p>
<p><code>CustomLogger</code> 类还定义了一些方法，包括 <code>debug()</code>、<code>info()</code>、<code>warning()</code>、<code>error()</code> 和 <code>critical()</code>，这些方法分别对应不同的日志级别，并将日志消息传递给 logger 对象进行处理。</p>
<p>使用该类时，您可以像下面这样实例化：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">logger = CustomLogger(logger_name=<span class="string">'my_logger'</span>, log_level=logging.INFO, log_dir=<span class="string">'/path/to/logs'</span>, log_filename=<span class="string">'my_app.log'</span>, console_log=<span class="literal">True</span>, file_log=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">logger.info(<span class="string">'Hello, world!'</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>这将创建一个名为 <code>my_logger</code> 的 logger 对象，日志级别为 <code>logging.INFO</code>，日志文件存储在 <code>/path/to/logs/my_app.log</code>，同时向控制台输出日志。然后，它将记录一条日志消息：“Hello, world</p>
<h3 id="jupyter"><a href="#jupyter" class="headerlink" title="jupyter"></a>jupyter</h3><p>如何在jupyter中可视化训练效果？</p>
<p>某些情况不方便弹窗把 env 界面实时渲染出来，所以我们通过下面两种方法环境的可视化，从而看到智能体的交互情况。</p>
<p>方法一：直接在jupyter中渲染</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gym</span><br><span class="line"><span class="keyword">from</span> IPython <span class="keyword">import</span> display</span><br><span class="line"><span class="keyword">import</span> matplotlib</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line">%matplotlib inline</span><br><span class="line"></span><br><span class="line"><span class="comment"># Set up fake display; otherwise rendering will fail</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">os.system(<span class="string">"Xvfb :1 -screen 0 1024x768x24 &amp;"</span>)</span><br><span class="line">os.environ[<span class="string">'DISPLAY'</span>] = <span class="string">':1'</span></span><br><span class="line"></span><br><span class="line">env = gym.make(<span class="string">'CartPole-v1'</span>)</span><br><span class="line">env.seed(<span class="number">23</span>)</span><br><span class="line">env.reset()</span><br><span class="line">img = plt.imshow(env.render(mode=<span class="string">'rgb_array'</span>)) <span class="comment"># only call this once</span></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">    img.set_data(env.render(mode=<span class="string">'rgb_array'</span>)) <span class="comment"># just update the data</span></span><br><span class="line">    display.display(plt.gcf())</span><br><span class="line">    display.clear_output(wait=<span class="literal">True</span>)</span><br><span class="line">    action = env.action_space.sample()</span><br><span class="line">    env.step(action)</span><br></pre></td></tr></table></figure>
<p>方法二：对环境进行录制，再播放视频</p>
<p>由于工具函数太长了，具体见github中的代码</p>
<p>下面录制视频和播放视频：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 录制视频</span></span><br><span class="line">record_video(<span class="string">'CartPole-v1'</span>, model, video_length=<span class="number">500</span>, prefix=<span class="string">'ppo2-cartpole'</span>)</span><br><span class="line"><span class="comment"># 展示视频</span></span><br><span class="line">show_videos(<span class="string">'videos'</span>, prefix=<span class="string">'ppo2'</span>)</span><br></pre></td></tr></table></figure>
<h2 id="网络结构"><a href="#网络结构" class="headerlink" title="网络结构"></a>网络结构</h2><ol>
<li><p>网络输出离散动作概率的时候，一般加一层<code>softmax</code>层，保证输出的离散动作概率和为1；输出连续动作概率的时候，一般加一层<code>tanh</code>层，因为<code>tanh</code>范围是[-1,1]，我们可以根据实际需要，将输出进行缩放。</p>
<p><img src="https://raw.githubusercontent.com/RisingAuroras/giteePagesImgs/master/202209110920372.png" alt="image-20220911092035223"></p>
</li>
<li></li>
</ol>
<h2 id="好玩的东西"><a href="#好玩的东西" class="headerlink" title="好玩的东西"></a>好玩的东西</h2><h3 id="print-函数-r转义字符"><a href="#print-函数-r转义字符" class="headerlink" title="print 函数 \r转义字符"></a>print 函数 <code>\r</code>转义字符</h3><blockquote>
<p>NOTE:</p>
<p>\r后的字符串替换前面输出的字符串.</p>
<p>eg.print(“hello\rwork”)输出为work</p>
</blockquote>
<p>下面的代码的功能是在训练中进度条式的显示输出结果，而不是一大长串字符输出。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">for</span> t <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"\rStep {} Episode {},{} loss=({})"</span>.<span class="built_in">format</span>(</span><br><span class="line">            t, i + <span class="number">1</span>, <span class="number">100</span>, np.random.randn()), end=<span class="string">""</span>)</span><br><span class="line">        time.sleep(<span class="number">0.1</span>)</span><br></pre></td></tr></table></figure>
<p>输出:</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Step 0 Episode 65,100 loss=(-2.30202248835621)</span><br></pre></td></tr></table></figure>
<p>最后结果</p>
<p><img src="https://raw.githubusercontent.com/RisingAuroras/giteePagesImgs/master/202301102101017.png" alt="image-20230110210135973"></p>
<p>其他效果，具体参考看这里<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_62651706/article/details/121602072">跳转</a></p>
<p><strong>（1）转圈效果</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"><span class="built_in">list</span> = [<span class="string">'|'</span>,<span class="string">'/'</span>,<span class="string">'—'</span>,<span class="string">'\\'</span>]    <span class="comment">#创建转圈效果的所有样式,'\\'是'\'本身</span></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">list</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">'\r正在加载中 %s '</span>%i,end=<span class="string">''</span>)</span><br><span class="line">        sleep(<span class="number">0.05</span>)    <span class="comment">#间隔0.05秒</span></span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/RisingAuroras/giteePagesImgs/master/202301102105858.gif" alt="img"></p>
<p><strong>（2）动态表情</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line">list1 = [<span class="string">'(づ｡◕ᴗᴗ◕｡)づ'</span>,<span class="string">'(づ｡—ᴗᴗ—｡)づ'</span>,<span class="string">'(づ｡◕ᴗᴗ◕｡)づ'</span>,<span class="string">'(づ｡—ᴗᴗ—｡)づ'</span>,<span class="string">'(づ｡◕ᴗᴗ◕｡)づ'</span>,</span><br><span class="line"><span class="string">'(づ｡◕ᴗᴗ◕｡)づ'</span>,<span class="string">'(づ｡◕ᴗᴗ◕｡)づ'</span>,<span class="string">'(づ｡◕ᴗᴗ◕｡)づ'</span>,<span class="string">'(づ｡◕ᴗᴗ◕｡)づ'</span>,<span class="string">'(づ｡◕ᴗᴗ◕｡)づ'</span>]</span><br><span class="line"><span class="comment">#第一个动态表情图的所有样式</span></span><br><span class="line">list2 = [<span class="string">'u~(@_@)~*'</span>,<span class="string">'u~(@_@)~*'</span>,<span class="string">'u~(@_@)~*'</span>,<span class="string">'u~(@_@)~*'</span>,<span class="string">'u~(@_@)~*'</span>,</span><br><span class="line"><span class="string">'u~(@_@)~*'</span>,<span class="string">'u~(—_—)~*'</span>,<span class="string">'u~(@_@)~*'</span>,<span class="string">'u~(—_—)~*'</span>,<span class="string">'u~(@_@)~*'</span>]</span><br><span class="line"><span class="comment">#第二个动态表情图的所有样式</span></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    <span class="keyword">for</span> a,b <span class="keyword">in</span> <span class="built_in">zip</span>(list1,list2):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">'\r %s %s '</span>%(a,b),end=<span class="string">''</span>)</span><br><span class="line">        sleep(<span class="number">0.15</span>)</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/RisingAuroras/giteePagesImgs/master/202301102106652.gif" alt="img"></p>
<p><strong>（3）进度条</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">51</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">'\r加载进度: [%-50s]%.2f%%  '</span>%(<span class="string">'#'</span>*i,i*<span class="number">2</span>),end=<span class="string">''</span>)</span><br><span class="line">        sleep(<span class="number">0.05</span>)</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/RisingAuroras/giteePagesImgs/master/202301102106763.gif" alt="img"></p>
<p><strong>我们还可以为它加上颜色：</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">51</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">'\r加载进度: [\033[32m%-50s\033[0m]\033[32m%.2f%%\033[0m  '</span>%(<span class="string">'#'</span>*i,i*<span class="number">2</span>),end=<span class="string">''</span>)</span><br><span class="line">        sleep(<span class="number">0.05</span>)</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/RisingAuroras/giteePagesImgs/master/202301102108700.gif" alt="img"></p>
<h2 id="计算机视觉"><a href="#计算机视觉" class="headerlink" title="计算机视觉"></a>计算机视觉</h2><h3 id="图像裁剪"><a href="#图像裁剪" class="headerlink" title="图像裁剪"></a>图像裁剪</h3><p>在计算机视觉中，通常将输入图像的大小调整为固定大小以便于模型处理。对于<code>resnet34</code>模型，它的输入尺寸是224x224。因此，我们需要对输入图像进行预处理，将其调整为224x224。但是，在将图像调整为目标大小之前，通常需要进行一些预处理操作来确保输入图像具有相同的特征。</p>
<p>在上面的示例中，首先将图像大小调整为256x256。这是因为图像通常具有不同的大小和宽高比，我们需要将其调整为统一的大小以确保输入图像具有相同的特征。然后，对调整后的图像进行中心裁剪为224x224，以确保图像的关键特征位于中心位置，这有助于提高模型的准确性。最后，将图像转换为张量并进行归一化，以便于模型进行处理。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://mr-maktoub.github.io">马克图布</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://mr-maktoub.github.io/posts/3815/">https://mr-maktoub.github.io/posts/3815/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://mr-maktoub.github.io" target="_blank">马克图布</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/trick/">trick</a></div><div class="post_share"><div class="social-share" data-image="/img/avatar1.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/f446/" title="常用命令"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">常用命令</div></div></a></div><div class="next-post pull-right"><a href="/posts/b58e/" title="常见的激活函数"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">常见的激活函数</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar1.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">马克图布</div><div class="author-info__description">记录我的遗忘</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">66</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">22</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">13</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B7%A5%E5%85%B7"><span class="toc-number">1.</span> <span class="toc-text">工具</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#pytorch"><span class="toc-number">1.1.</span> <span class="toc-text">pytorch</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%85%E5%AD%98%E7%9B%B8%E5%85%B3"><span class="toc-number">1.1.1.</span> <span class="toc-text">内存相关</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8E%9F%E5%9C%B0%E6%93%8D%E4%BD%9C"><span class="toc-number">1.1.1.1.</span> <span class="toc-text">原地操作</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#EarlyStopping"><span class="toc-number">1.1.2.</span> <span class="toc-text">EarlyStopping</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#linux-%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AE%88%E6%8A%A4%E7%BA%BF%E7%A8%8B%E2%80%94%E2%80%94tmux"><span class="toc-number">1.2.</span> <span class="toc-text">linux 服务器守护线程——tmux</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Python"><span class="toc-number">1.3.</span> <span class="toc-text">Python</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#jupyter"><span class="toc-number">1.4.</span> <span class="toc-text">jupyter</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E7%BB%93%E6%9E%84"><span class="toc-number">2.</span> <span class="toc-text">网络结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A5%BD%E7%8E%A9%E7%9A%84%E4%B8%9C%E8%A5%BF"><span class="toc-number">3.</span> <span class="toc-text">好玩的东西</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#print-%E5%87%BD%E6%95%B0-r%E8%BD%AC%E4%B9%89%E5%AD%97%E7%AC%A6"><span class="toc-number">3.1.</span> <span class="toc-text">print 函数 \r转义字符</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89"><span class="toc-number">4.</span> <span class="toc-text">计算机视觉</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%BE%E5%83%8F%E8%A3%81%E5%89%AA"><span class="toc-number">4.1.</span> <span class="toc-text">图像裁剪</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/3eeb/" title="Hello World">Hello World</a><time datetime="2023-06-01T07:29:35.968Z" title="发表于 2023-06-01 15:29:35">2023-06-01</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/6f25/" title="我的云音乐APP开发课程笔记">我的云音乐APP开发课程笔记</a><time datetime="2023-06-01T07:29:35.962Z" title="发表于 2023-06-01 15:29:35">2023-06-01</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/8462/" title="重新梳理Android权限管理">重新梳理Android权限管理</a><time datetime="2023-06-01T07:29:35.959Z" title="发表于 2023-06-01 15:29:35">2023-06-01</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/9958/" title="《吴恩达机器学习笔记》">《吴恩达机器学习笔记》</a><time datetime="2023-06-01T07:29:35.949Z" title="发表于 2023-06-01 15:29:35">2023-06-01</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/935d/" title="常见不等式、等式与基础理论">常见不等式、等式与基础理论</a><time datetime="2023-06-01T07:29:35.914Z" title="发表于 2023-06-01 15:29:35">2023-06-01</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By 马克图布</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        insertScript: [200, () => {
          document.querySelectorAll('mjx-container').forEach(node => {
            if (node.hasAttribute('display')) {
              btf.wrap(node, 'div', { class: 'mathjax-overflow' })
            } else {
              btf.wrap(node, 'span', { class: 'mathjax-overflow' })
            }
          });
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typesetPromise()
}</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>